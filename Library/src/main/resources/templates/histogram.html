<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ru">
<head>
    <meta charset="utf-8">
    <title>Гистограмма</title>
    <script src="https://www.google.com/jsapi"></script>
</head>
<body>
<table id="1" class="ui-helper-hidden" style="display:none;">
    <thead>
    <tr>
        <th scope="col">ID книги</th>
        <th scope="col">Название книги</th>
        <th scope="col">Издательство</th>
        <th scope="col">Дата выдачи книги студенту</th>
        <th scope="col">ФИО студента</th>
        <th scope="col">Дата сдачи книги студентом в библиотеку</th>
    </tr>
    </thead>
    <tbody>
    <tr th:each="library: ${listLibraries}" class="table-tr">
        <th scope="row" class="table-th" th:text="${library.id}">ID книги отстутсвует</th>
        <th scope="row" class="table-th" th:text="${library.book_name}">Имя книги отсутствует</th>
        <th scope="row" class="table-th" th:text="${library.publisher}">Имя издателя отсутствует</th>
        <th scope="row" class="table-th" th:text="${library.date_of_issue}">Дата выдачи книги студенту отсутствует</th>
        <th scope="row" class="table-th" th:text="${library.student_name}">ФИО студента отсутствует</th>
        <th scope="row" class="table-th" th:text="${library.date_of_delivery}">Дата сдачи книги студента отсутствует</th>
    </tr>
    </tbody>
</table>
<div class="container">
    <canvas id="hist" width="400" height="200"></canvas>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.8.0/Chart.bundle.min.js"></script>
<script type="text/javascript">
    function getRandomInt(min, max) {
        return Math.floor(Math.random() * (max - min)) + min;
    }

    labels = []
    data = []
    let tr = document.getElementsByClassName('table-tr');
    for (let i = 0; i < tr.length; i++) {
        let t = tr[i].getElementsByClassName('table-th')[3].textContent;

        if (!labels.includes(t)) {
            let ind = Math.max(labels.length, 0);
            labels[ind] = t;
            data[ind] = 1;
        } else {
            let ind = labels.indexOf(t);
            data[ind] += 1;
        }
    }

    let colors = [];
    for (let i = 0; i < labels.length; i++) {
        let temp = 'rgba(' + getRandomInt(0, 256) + ', ' + getRandomInt(0, 256) + ', ' + getRandomInt(0, 256) + ', 1)';
        while (colors.includes(temp)) {
            temp = 'rgba(' + getRandomInt(0, 256) + ', ' + getRandomInt(0, 256) + ', ' + getRandomInt(0, 256) + ', 1)';
        }

        colors[i] = temp;
    }

    let dataset = {
        label: 'Количество книг',
        data: data,
        backgroundColor: colors,
        borderWidth: 1,
    }

    Chart.defaults.global.defaultFontColor='white';

    let ctx = document.getElementById('hist').getContext('2d');
    let myChart = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: labels,
            datasets: [dataset],
        },
        options: {
            legend: {
                display: false,
            },
            title: {
                display: true,
                text: 'Количество книг по дате выдачи',
                position: 'top',
                fontSize: 24,
                padding: 20,
                fontColor: "black",
            },
            scales: {
                yAxes: [{
                    ticks: {
                        beginAtZero:true,
                        stepSize: 1,
                    },
                    scaleLabel: {
                        display: true,
                        labelString: 'Количество книг',
                        fontSize: 18,
                        fontColor: "black"
                    },
                }],
                xAxes: [{
                    scaleLabel: {
                        display: true,
                        labelString: 'Дата',
                        fontSize: 18,
                        fontColor: "black"
                    },
                }],
            },
        },
    });
</script>

<a href="/">
    <button type="button" class="btn btn-light" data-togge="button" aria-pressed="false" autocomplete="off">
        Вернуться на главную страницу
    </button>
</a>
</body>
</html>